// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "mongodb"
    url      = env("DATABASE_URL")
}

// Członkowie biblioteki (Czytelnicy)
model Members {
    id        String   @id @default(auto()) @map("_id") @db.ObjectId
    name      String
    email     String   @unique
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    
    // Relacja: jeden członek może mieć wiele wypożyczeń
    loans     Loans[]
    
    @@map("members")
}

// Książki
model Books {
    id          String   @id @default(auto()) @map("_id") @db.ObjectId
    isbn        String?  @unique
    title       String
    author      String
    year        String?
    publisher   String?
    imageUrlS   String?
    imageUrlM   String?
    imageUrlL   String?
    copies      Int      @default(1) // liczba egzemplarzy
    createdAt   DateTime @default(now())
    updatedAt   DateTime @updatedAt
    
    // Relacja: jedna książka może być wielokrotnie wypożyczona
    loans       Loans[]
    
    @@map("books")
}

// Wypożyczenia
model Loans {
    id         String    @id @default(auto()) @map("_id") @db.ObjectId
    
    // Relacje
    memberId   String    @db.ObjectId
    member     Members   @relation(fields: [memberId], references: [id], onDelete: Cascade)
    
    bookId     String    @db.ObjectId
    book       Books     @relation(fields: [bookId], references: [id], onDelete: Cascade)
    
    // Daty
    loanDate   DateTime  @default(now())
    dueDate    DateTime
    returnDate DateTime? // NULL = aktywne wypożyczenie
    
    createdAt  DateTime  @default(now())
    updatedAt  DateTime  @updatedAt
    
    @@map("loans")
}

model Products {
    id         String       @id @default(auto()) @map("_id") @db.ObjectId
    name       String
    price      Float
    createdAt  DateTime     @default(now())
    updatedAt  DateTime     @updatedAt
    
    orderItems OrderItems[]
    
    @@map("products")
}

model Orders {
    id         String       @id @default(auto()) @map("_id") @db.ObjectId
    createdAt  DateTime     @default(now())
    
    items      OrderItems[]
    
    @@map("orders")
}

model OrderItems {
    id         String   @id @default(auto()) @map("_id") @db.ObjectId
    
    orderId    String   @db.ObjectId
    order      Orders   @relation(fields: [orderId], references: [id], onDelete: Cascade)
    
    productId  String   @db.ObjectId
    product    Products @relation(fields: [productId], references: [id], onDelete: Cascade)
    
    qty        Int
    price      Float
    
    @@map("order_items")
}

model Posts {
    id         String     @id @default(auto()) @map("_id") @db.ObjectId
    title      String
    body       String
    createdAt  DateTime   @default(now())
    updatedAt  DateTime   @updatedAt
    
    comments   Comments[]
    
    @@map("posts")
}

model Comments {
    id         String   @id @default(auto()) @map("_id") @db.ObjectId
    
    postId     String   @db.ObjectId
    post       Posts    @relation(fields: [postId], references: [id], onDelete: Cascade)
    
    author     String
    body       String
    approved   Int      @default(0) // 0 = czeka na moderację, 1 = zatwierdzony
    createdAt  DateTime @default(now())
    updatedAt  DateTime @updatedAt
    
    @@map("comments")
}
